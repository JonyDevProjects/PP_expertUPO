<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruta Cr√≠tica vs Holgura - Infograf√≠a Interactiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap');
        
        body { font-family: 'Roboto', sans-serif; background-color: #f8fafc; }

        /* Custom Pattern for Float/Slack */
        .float-pattern {
            background-image: repeating-linear-gradient(
                45deg,
                rgba(59, 130, 246, 0.1),
                rgba(59, 130, 246, 0.1) 10px,
                rgba(59, 130, 246, 0.05) 10px,
                rgba(59, 130, 246, 0.05) 20px
            );
            border: 2px dashed #93c5fd;
        }

        .task-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .arrow-line {
            position: absolute;
            height: 2px;
            background-color: #cbd5e1;
            z-index: 0;
            transform-origin: left center;
        }

        .critical-glow {
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
            border-color: #ef4444 !important;
        }

        /* Tooltip */
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="text-slate-700">

    <!-- Header -->
    <header class="bg-slate-900 text-white p-6 shadow-lg border-b-4 border-red-500">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <div>
                <h1 class="text-3xl font-black text-white"><i class="fas fa-project-diagram mr-3 text-red-500"></i>Ruta Cr√≠tica (CPM) vs. Holgura</h1>
                <p class="text-slate-400 mt-1">Gesti√≥n de Prioridades: ¬øQu√© tareas no pueden esperar?</p>
            </div>
            <div class="mt-4 md:mt-0 flex space-x-6 text-sm">
                <div class="flex items-center"><div class="w-4 h-4 bg-red-500 rounded mr-2"></div>Cr√≠tica (0 Holgura)</div>
                <div class="flex items-center"><div class="w-4 h-4 bg-blue-500 rounded mr-2"></div>No Cr√≠tica</div>
                <div class="flex items-center"><div class="w-4 h-4 border-2 border-dashed border-blue-400 bg-blue-50 rounded mr-2"></div>Holgura (Float)</div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 md:p-8">

        <!-- CONCEPT BAR -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-4 rounded-lg shadow border-l-4 border-red-500">
                <h3 class="font-bold text-red-700 text-lg mb-1">üî• Ruta Cr√≠tica (Camino Rojo)</h3>
                <p class="text-sm text-slate-600">Determina la duraci√≥n total del proyecto. <b>No tiene espacios vac√≠os</b>. Cualquier retraso aqu√≠ retrasa la fecha de entrega final.</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                <h3 class="font-bold text-blue-700 text-lg mb-1">‚ùÑÔ∏è Holgura (Camino Azul)</h3>
                <p class="text-sm text-slate-600">Tiempo extra disponible. Visualmente es un <b>hueco al final</b> de la cadena. Si te retrasas dentro de este margen, el proyecto no sufre.</p>
            </div>
        </div>

        <!-- INTERACTIVE CHART -->
        <div class="bg-white rounded-xl shadow-xl p-2 md:p-8 relative overflow-hidden">
            
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-slate-800">Diagrama de Red Cronol√≥gico</h2>
                <div class="bg-slate-100 px-4 py-2 rounded-lg text-sm font-mono font-bold text-slate-600 border border-slate-200">
                    Duraci√≥n Proyecto: <span id="total-duration" class="text-red-600 text-lg">10</span> d√≠as
                </div>
            </div>

            <!-- TIMELINE RULER -->
            <div class="relative h-8 w-full border-b border-slate-300 mb-6 flex text-xs text-slate-400 font-mono">
                <!-- Generated by JS -->
                <div id="timeline-ruler" class="w-full h-full flex"></div>
            </div>

            <!-- NETWORK DIAGRAM CONTAINER -->
            <div class="relative h-[300px] w-full bg-slate-50 rounded-lg border border-slate-200 p-4" id="network-container">
                
                <!-- ROW 1: CRITICAL PATH -->
                <div class="absolute top-10 left-0 w-full flex items-center px-4">
                    <div class="w-8 text-xs font-bold text-red-400 -ml-2 transform -rotate-90">CR√çTICO</div>
                    <div class="flex-1 relative h-16" id="track-critical">
                        <!-- Tasks A, B injected here -->
                    </div>
                </div>

                <!-- ROW 2: NON-CRITICAL PATH -->
                <div class="absolute top-40 left-0 w-full flex items-center px-4">
                    <div class="w-8 text-xs font-bold text-blue-400 -ml-2 transform -rotate-90">HOLGURA</div>
                    <div class="flex-1 relative h-16" id="track-float">
                        <!-- Tasks C, D injected here -->
                    </div>
                </div>

                <!-- CONNECTORS SVG -->
                <svg class="absolute top-0 left-0 w-full h-full pointer-events-none" id="svg-connectors">
                    <defs>
                        <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" />
                        </marker>
                        <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6" />
                        </marker>
                    </defs>
                    <!-- Lines injected by JS -->
                </svg>

            </div>

            <!-- CONTROLS -->
            <div class="mt-8 bg-slate-100 rounded-lg p-6 border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4"><i class="fas fa-sliders-h mr-2"></i>Simulador de Incidencias</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Control Non-Critical -->
                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-sm font-bold text-blue-700">Duraci√≥n Tarea D (Camino Azul)</label>
                            <span id="val-task-d" class="text-sm font-mono bg-blue-100 text-blue-800 px-2 rounded">3 d√≠as</span>
                        </div>
                        <input type="range" id="slider-d" min="1" max="8" value="3" class="w-full accent-blue-600 cursor-pointer" oninput="updateSimulation()">
                        <p class="text-xs text-slate-500 mt-2">Aumenta la duraci√≥n para ver c√≥mo se "comen" la holgura (el hueco).</p>
                    </div>

                    <!-- Control Critical -->
                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-sm font-bold text-red-700">Duraci√≥n Tarea B (Camino Rojo)</label>
                            <span id="val-task-b" class="text-sm font-mono bg-red-100 text-red-800 px-2 rounded">5 d√≠as</span>
                        </div>
                        <input type="range" id="slider-b" min="2" max="8" value="5" class="w-full accent-red-600 cursor-pointer" oninput="updateSimulation()">
                        <p class="text-xs text-slate-500 mt-2">Cualquier cambio aqu√≠ afecta inmediatamente al fin del proyecto.</p>
                    </div>
                </div>

                <!-- STATUS MESSAGE -->
                <div id="status-message" class="mt-6 p-3 rounded text-center text-sm font-bold bg-green-100 text-green-700 transition-colors duration-300">
                    Situaci√≥n Estable: Tienes 2 d√≠as de holgura.
                </div>
            </div>

        </div>

        <!-- EXPLANATION -->
        <div class="mt-6 text-sm text-slate-500 italic text-center">
            * Nota: En este diagrama simplificado, todas las rutas comienzan el d√≠a 0. La Ruta Cr√≠tica es la secuencia m√°s larga.
        </div>

    </main>

    <script>
        // --- CONSTANTS & STATE ---
        const totalPixels = 100; // Represents 100% width
        const maxDaysScale = 15; // Max days shown on timeline
        
        let state = {
            taskA_duration: 5, // Critical Path Task 1
            taskB_duration: 5, // Critical Path Task 2
            taskC_duration: 2, // Non-Critical Path Task 1
            taskD_duration: 3  // Non-Critical Path Task 2 (The one we change)
        };

        // --- INIT TIMELINE RULER ---
        const ruler = document.getElementById('timeline-ruler');
        for(let i=0; i<=maxDaysScale; i++) {
            const tick = document.createElement('div');
            tick.className = "flex-1 border-l border-slate-300 h-full relative";
            if(i > 0) {
                tick.innerHTML = `<span class="absolute -bottom-4 -left-1 text-[10px]">${i}</span>`;
            }
            ruler.appendChild(tick);
        }

        // --- RENDER FUNCTION ---
        function updateSimulation() {
            // 1. Get Values
            state.taskD_duration = parseInt(document.getElementById('slider-d').value);
            state.taskA_duration = parseInt(document.getElementById('slider-b').value); // Using slider B label for Task A logic visually
            
            // Fixed other tasks for simplicity of demo
            const taskACritical = state.taskA_duration; 
            const taskBCritical = 5; // Fixed 2nd part of critical path

            const taskCNonCritical = 2; // Fixed start of non-critical
            const taskDNonCritical = state.taskD_duration;

            // 2. Calculations
            const pathCriticalLength = taskACritical + taskBCritical;
            const pathNonCriticalLength = taskCNonCritical + taskDNonCritical;

            // Determine WHO is Critical (Dynamic CPM)
            const totalDuration = Math.max(pathCriticalLength, pathNonCriticalLength);
            const isBlueCritical = pathNonCriticalLength >= pathCriticalLength;
            const float = Math.abs(pathCriticalLength - pathNonCriticalLength);

            // 3. Update Text
            document.getElementById('val-task-d').innerText = `${state.taskD_duration} d√≠as`;
            document.getElementById('val-task-b').innerText = `${state.taskA_duration} d√≠as`;
            document.getElementById('total-duration').innerText = totalDuration;

            const statusMsg = document.getElementById('status-message');
            if(isBlueCritical && float === 0) {
                statusMsg.className = "mt-6 p-3 rounded text-center text-sm font-bold bg-orange-100 text-orange-700 animate-pulse";
                statusMsg.innerHTML = "<i class='fas fa-exclamation-triangle'></i> ¬°Ruta Cr√≠tica Cambiada! El camino Azul ahora es Cr√≠tico.";
            } else if (isBlueCritical) {
                // Blue is longer
                statusMsg.className = "mt-6 p-3 rounded text-center text-sm font-bold bg-red-100 text-red-700";
                statusMsg.innerHTML = `¬°RETRASO! El proyecto se ha alargado ${float} d√≠as por culpa del camino Azul.`;
            } else {
                // Normal
                statusMsg.className = "mt-6 p-3 rounded text-center text-sm font-bold bg-green-100 text-green-700";
                statusMsg.innerHTML = `Situaci√≥n Estable: Tienes ${float} d√≠as de holgura en el camino azul.`;
            }

            // 4. Render Tasks (Width in %)
            // Scale: 100% width = maxDaysScale
            const dayUnit = 100 / maxDaysScale;

            const trackCrit = document.getElementById('track-critical');
            const trackFloat = document.getElementById('track-float');
            
            // --- DRAW CRITICAL ROW (Top) ---
            // Task A (Variable) + Task B (Fixed 5)
            // If Blue becomes critical, Red becomes non-critical (shows float). 
            // BUT for simplicity, we assume Red is Baseline Critical.

            // Render RED PATH
            let htmlRed = `
                <div class="h-12 bg-red-500 rounded text-white flex items-center justify-center text-xs font-bold shadow-md absolute top-2 border-2 border-red-600 z-10 task-card" 
                     style="width: ${taskACritical * dayUnit}%; left: 0;">
                     Tarea A (${taskACritical}d)
                </div>
                <div class="h-12 bg-red-500 rounded text-white flex items-center justify-center text-xs font-bold shadow-md absolute top-2 border-2 border-red-600 z-10 task-card" 
                     style="width: ${taskBCritical * dayUnit}%; left: ${taskACritical * dayUnit}%;">
                     Tarea B (5d)
                </div>
            `;
            
            // If Blue is Critical (Longer), Red has float visual
            if(isBlueCritical) {
                const redFloat = float * dayUnit;
                const redEnd = (taskACritical + taskBCritical) * dayUnit;
                htmlRed += `
                    <div class="h-12 float-pattern rounded flex items-center justify-center text-[10px] text-blue-400 font-mono absolute top-2"
                        style="width: ${redFloat}%; left: ${redEnd}%;">
                        Holgura
                    </div>
                `;
            }
            trackCrit.innerHTML = htmlRed;


            // --- DRAW BLUE ROW (Bottom) ---
            // Task C (Fixed 2) + Task D (Variable)
            const blueColor = isBlueCritical ? "bg-red-500 border-red-600 critical-glow" : "bg-blue-500 border-blue-600";
            
            let htmlBlue = `
                <div class="h-12 ${blueColor} rounded text-white flex items-center justify-center text-xs font-bold shadow-md absolute top-2 border-2 z-10 task-card" 
                     style="width: ${taskCNonCritical * dayUnit}%; left: 0;">
                     Tarea C (2d)
                </div>
                <div class="h-12 ${blueColor} rounded text-white flex items-center justify-center text-xs font-bold shadow-md absolute top-2 border-2 z-10 task-card" 
                     style="width: ${taskDNonCritical * dayUnit}%; left: ${taskCNonCritical * dayUnit}%;">
                     Tarea D (${taskDNonCritical}d)
                </div>
            `;

            // Draw Float (Gap) if Red is still critical (Blue is shorter)
            if(!isBlueCritical) {
                const blueFloat = float * dayUnit;
                const blueEnd = (taskCNonCritical + taskDNonCritical) * dayUnit;
                htmlBlue += `
                     <div class="h-12 float-pattern rounded flex items-center justify-center text-[10px] text-blue-400 font-mono absolute top-2 z-0"
                        style="width: ${blueFloat}%; left: ${blueEnd}%;">
                        <span class="bg-white px-1 rounded shadow-sm opacity-80">${float} d√≠as libres</span>
                    </div>
                    <!-- Virtual End Line -->
                    <div class="absolute top-0 bottom-0 w-0.5 bg-red-400 border-l border-dashed border-red-500 z-20" style="left: ${(blueEnd + blueFloat)}%; height: 100px; top: -100px; opacity: 0.3;"></div>
                `;
            }
            trackFloat.innerHTML = htmlBlue;

            // Update SVG lines (Simplified visual connectors)
            // Just drawing vertical connection at start and end
            // (Skipped for cleaner HTML implementation, the bars align visually)
        }

        // Init
        updateSimulation();

    </script>
</body>
</html>